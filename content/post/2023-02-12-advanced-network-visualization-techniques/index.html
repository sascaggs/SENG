---
title: Advanced Network Visualization Techniques
author: Shane A. Scaggs
date: '2023-02-12'
slug: advanced-network-visualization-techniques
categories:
  - methods
tags:
  - visualization
  - simulation
  - coding
  - workflow
---



<p><img src="images/network%20spaghetti.JPG" style="width:90.0%" /></p>
<p>Picture this: You’re working on project and you’ve just finished collecting all your network data. You’ve worked hard to get a complete network and you’re eager to start analyzing it. You power up your computer, load up Rstudio, and after lots of careful wrangling and tidying, you’re ready to plot the network. With great anticipation, you write a little code and WHAM! you get hit with a hot plate of spaghetti and meatballs.</p>
<p>Anyone who has tried to visualize a network that is even remotely <a href="https://seng.netlify.app/2021/12/22/size-structure-and-density/">dense</a> can probably relate to this experience. That’s because networks are complex, multidimensional objects; some of the most difficult objects to visualize.</p>
<div id="simplicity-of-design-and-the-data-density-problem" class="section level1">
<h1>Simplicity of design and the data density problem</h1>
<p>The great statistician Edward Tufte is an expert at data visualization. His book <em>The Visual Display of Quantitative Information</em> gives us many guidelines for designing pleasant graphs. But there are two bits of information that will specifically help us understand how to produce effective network visualizations. The first comes from one of his most well known quotations:</p>
<blockquote>
<p>Graphical elegance is often found in simplicity of design and complexity of data.</p>
</blockquote>
<p>Networks are, by definition, complex objects. This is true even for graphs with a small quantity of nodes and edges. The inherent complexity of networks means that we must <strong>always</strong> strive for simplicity when we visualize a network. This means you have no choice but to minimize the number of visual aesthetics used in the visualization. Ask yourself: what is the single most essential feature of this network that I want the my audience to appreciate? Let this essence guide your design.</p>
<p>The second piece of advice is to maximize data density, within reason. This principle, for example, guides our decisions about the range of values on the axes of any plot. The axes to be constrained to the range of values for which we actually have data.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-2"></span>
<img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-2-1.png" alt="Two example scatterplots for the same data. The plot on the left has low data density that is caused by specifying axis ranges that are well beyond the range of the data. The plot on the right fixes this problem, and as a result, we see a more honest portrayal of the pattern." width="90%" />
<p class="caption">
Figure 1: Two example scatterplots for the same data. The plot on the left has low data density that is caused by specifying axis ranges that are well beyond the range of the data. The plot on the right fixes this problem, and as a result, we see a more honest portrayal of the pattern.
</p>
</div>
<p>Fixing data density problems in conventional graphs, like the scatterplots above, can be pretty simple. But networks pose problems because they tend to have high data density to begin with. This make any additional aesthetic choice risky because it can take us beyond a reasonable data density that viewers can actually comprehend. There is also no straight forward way to change axes or omit nodes and edges without distorting our representation of the network structure.</p>
<p>Let’s look at some techniques to deal with data density and then we will move on to some other graphical challenges with networks.</p>
</div>
<div id="start-with-a-simulation" class="section level1">
<h1>Start with a simulation</h1>
<p>Let’s start by simulating a network that we can use to illustrate some of these techniques. For details about how to simulate networks using <code>statnet</code>, check out our <a href="https://seng.netlify.app/meetings/introduction-to-network-simulation-with-statnet/">previous post</a> on the topic. We want to use a simulation because 1) we can create challenges and learn to overcome them, and 2) we know the correct answers for the graph structure and the attributes, which helps us know whether we have been successful or not.</p>
<p>We will simulate a network composed of three groups who tend to form edges with other agents of the same group. This is a homophilous network, and we will keep it fairly dense.</p>
<pre class="r"><code># load package
library(statnet )

# seed for reproducibility
set.seed(777)

# how many nodes? how many groups?  
N = 60 
groups = c(&#39;G1&#39;,&#39;G2&#39;,&#39;G3&#39;)

# initialize empty network 
empty_g = network( N, directed = TRUE, density = 0 )

# create group attribute 
empty_g %v% &#39;group&#39; = sample( groups, size = N, replace = TRUE )

# set parameters for edge density (edges) and homophily (nodematch) and reciprocity (mutual)
# remember these are in log-odds where 0 = 50/50
pars = c(-4,1,2) 

# simulate 
sim_g = simulate( empty_g ~ edges + nodematch(&#39;group&#39;) + mutual, coef = pars )
plot(sim_g)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-3-1.png" width="90%" /></p>
</div>
<div id="highlighting-group-structure" class="section level1">
<h1>Highlighting group structure</h1>
<p>This graph is structured by three groups. We know because we wrote the simulation. But this structure is not obvious from the graph you see above. It looks like spaghetti and meatballs. A good starting point would be to color each node according to it’s group.</p>
<pre class="r"><code># load packages 
library(tidygraph)
library(ggraph)

sim_g %&gt;% 
    as_tbl_graph %&gt;%
    ggraph() + 
    theme_graph() + 
    geom_edge_link() + 
    geom_node_point( aes(color=group) )</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-1.png" width="90%" /></p>
<p>This helps a little bit, but we can do better.</p>
<div id="using-small-multiples" class="section level2">
<h2>Using small multiples</h2>
<p>Tufte advises us to use <em>small multiples</em> – repeated versions of the same graph with different emphases – to maintain data density while improved clarity. When using tools like <code>ggplot2</code> or <code>graph</code>, we can create small multiples by using <em>facets</em>.</p>
<p>Facetting takes a graph and splits it into multiple smaller graphs based on a factor. In this case, we want to split the graph based on <code>group</code>, a node attribute. For this we want to use <code>facet_nodes</code>.</p>
<pre class="r"><code>sim_g %&gt;% 
    as_tbl_graph %&gt;%
    ggraph() + 
    theme_graph() + 
    geom_edge_link() + 
    geom_node_point( aes(color=group) ) + 
    facet_nodes(~group)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-5-1.png" width="90%" /></p>
<p>Now we are able to see more clearly how each group is connected in the graph. However, this technique does pose a new problem: it is too easy to assume that these are three separate networks. There are two ways to solve this problem, and they both will require a package called <code>patchwork</code>. This package allows us to combine multiple graphs using <code>+</code> for side to side and <code>/</code> for top and bottom<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<div id="option-1-add-a-reference-graph" class="section level3">
<h3>Option 1: Add a reference graph</h3>
<p>One choice we have is to plot the network in full as a reference and then use the facets to draw out the subgraphs. We just add them together with <code>patchwork</code>.</p>
<pre class="r"><code># full network 
full = sim_g %&gt;% 
    as_tbl_graph %&gt;%
    ggraph() + 
    theme_graph() + 
    geom_edge_link() + 
    geom_node_point( aes(color=group) ) + 
    theme(legend.position = &#39;none&#39;) + 
    ggtitle(&quot;Full network&quot;)

# sub graphs
sub = sim_g %&gt;% 
    as_tbl_graph %&gt;%
    ggraph() + 
    theme_graph() + 
    geom_edge_link() + 
    geom_node_point( aes(color=group) ) + 
    facet_nodes(~group) + 
    ggtitle(&quot;Network subgroups&quot;)


full + sub + plot_layout(widths = c(2,5))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-6-1.png" width="90%" /></p>
<p>All we have really done in this new graph is the following:</p>
<ol style="list-style-type: decimal">
<li>Plot the full network.</li>
<li>Plot the faceted version.</li>
<li>Save plots as objects and add them together.</li>
<li>Provide titles with <code>ggtitle</code>.</li>
<li>Remove the legend from the first graph; it is redundant.</li>
<li>Adjust the relative widths using <code>plot_layout</code>.</li>
</ol>
<p>There is more we could do to make it even prettier but this really helps clarify the full network.</p>
</div>
<div id="option-2-plot-three-separate-networks-with-different-emphases" class="section level3">
<h3>Option 2: Plot three separate networks with different emphases</h3>
<p>The second option is similar to the first but takes a different path. We will plot the network three separate times but in each graph, we will de-emphasize all but one group. Again, we can string these together using <code>patchwork</code>.</p>
<p>This approach is slightly more complicated then the first because we want to emphasize both the nodes and edges in each group. To do this, we need to create edge attributes for edges that connect occur between groups G1, G2, G3 as well those edges that are not homophilous.</p>
<pre class="r"><code>sim_g = sim_g %&gt;%
    as_tbl_graph() %&gt;%
    activate(edges) %&gt;%
    mutate(group_from = .N()$group[from], 
           group_to = .N()$group[to], 
           group_match = ifelse( group_from == &#39;G1&#39; &amp; group_to == &#39;G1&#39;, &#39;G1&#39;, 
                         ifelse( group_from == &#39;G2&#39; &amp; group_to == &#39;G2&#39;, &#39;G2&#39;, 
                         ifelse( group_from == &#39;G3&#39; &amp; group_to == &#39;G3&#39;, &#39;G3&#39;, &#39;No match&#39; ))))
sim_g</code></pre>
<pre><code>## # A tbl_graph: 60 nodes and 136 edges
## #
## # A directed simple graph with 3 components
## #
## # Edge Data: 136 × 6 (active)
##    from    to na    group_from group_to group_match
##   &lt;int&gt; &lt;int&gt; &lt;lgl&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;      
## 1     1     3 FALSE G1         G1       G1         
## 2     1    37 FALSE G1         G3       No match   
## 3     2    11 FALSE G2         G3       No match   
## 4     2    21 FALSE G2         G3       No match   
## 5     2    22 FALSE G2         G2       G2         
## 6     2    32 FALSE G2         G3       No match   
## # … with 130 more rows
## #
## # Node Data: 60 × 3
##   group na    name 
##   &lt;chr&gt; &lt;lgl&gt; &lt;chr&gt;
## 1 G1    FALSE 1    
## 2 G2    FALSE 2    
## 3 G1    FALSE 3    
## # … with 57 more rows</code></pre>
<p>This code looks a bit more intimidating than it really is. What we have are two essential steps:</p>
<ol style="list-style-type: decimal">
<li>Code each edge according to the group of each sender (<code>group_from</code>) and each receiver (<code>group_to</code>). This is done by activating the edges (<code>activate(edges)</code>) and then using the <code>.N()$group[from]</code> to pull out the node attributes at each edge.</li>
<li>Next, we use these two new edge attributes within some nested <code>ifelse</code> statements where we ask if the groups are the same, and if so, assign that group to the edge.</li>
</ol>
<p>One we have those attributes, we can use them to color the nodes and edges.</p>
<pre class="r"><code>g1 = sim_g %&gt;%
    ggraph() + 
    theme_graph() + 
    geom_edge_link( aes(color=group_match) ) + 
    geom_node_point( aes( color=group) ) + 
    scale_edge_color_manual( values = c(&#39;#ad003f&#39;,&#39;#cccccc77&#39;,&#39;#cccccc77&#39;,&#39;#cccccc77&#39;), guide = NULL) + 
    scale_color_manual(values = c(&#39;#ad003f&#39;,&#39;#cccccc77&#39;,&#39;#cccccc77&#39;), guide = NULL) + 
    ggtitle(&#39;Group 1&#39;)
                                        
g2 = sim_g %&gt;%
    ggraph() + 
    theme_graph() + 
    geom_edge_link( aes(color=group_match) ) + 
    geom_node_point( aes( color=group) ) + 
    scale_edge_color_manual( values = c(&#39;#cccccc77&#39;,&#39;#d2a52e&#39;,&#39;#cccccc77&#39;,&#39;#cccccc77&#39;), guide = NULL) + 
    scale_color_manual(values = c(&#39;#cccccc77&#39;,&#39;#d2a52e&#39;,&#39;#cccccc77&#39;), guide = NULL) + 
    ggtitle(&#39;Group 2&#39;)   

g3 = sim_g %&gt;%
    ggraph() + 
    theme_graph() + 
    geom_edge_link( aes(color=group_match) ) + 
    geom_node_point( aes( color=group) ) + 
    scale_edge_color_manual( values = c(&#39;#cccccc77&#39;,&#39;#cccccc77&#39;,&#39;#00c994&#39;,&#39;#cccccc77&#39;), guide = NULL) + 
    scale_color_manual(values = c(&#39;#cccccc77&#39;,&#39;#cccccc77&#39;,&#39;#00c994&#39;), guide = NULL) + 
    ggtitle(&#39;Group 3&#39;) 
                                        
g1 + g2 + g3</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-8"></span>
<img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-8-1.png" alt="Group substructure in a homophilous network. Each panel emphasizes one group of nodes in the graph with all other edges colored grey." width="99%" />
<p class="caption">
Figure 2: Group substructure in a homophilous network. Each panel emphasizes one group of nodes in the graph with all other edges colored grey.
</p>
</div>
<p>Now we’ve just repeated the same graph three times. We use an all grey palette and just switch out one of the grey colors for a emphasis color based on the position of the group name in the vector, e.g., group 1 is position 1 in the vector of color values.</p>
<p>One complication with this approach is how to create a legend. There is a solution to this but it requires making plot with all the colors, extracting only the legend, and then plotting the legend alone in a fourth panel. I’ve gotten around this by using titles and explaining the colors in the caption.</p>
</div>
<div id="a-note-on-layouts" class="section level3">
<h3>A note on layouts</h3>
<p>We will focus on layouts a bit more later on in this post, but I just want to make one thing explicit about the two examples above:</p>
<blockquote>
<p>The layout must be the same for each graph, otherwise it will be impossible to visually compare the structure across graphs.</p>
</blockquote>
<p>The layout for these graphs is the <code>ggraph</code> default called <code>"stress"</code>. Because this layout does not randomly change each time we make a plot – unlike Fruchterman-Reingold layouts, for example – we don’t need to do anything special. But if you want to use a different layout that has more randomness to it, you can save the layout first and then reuse it. This is done within <code>igraph</code> but can be transferred to <code>ggraph</code> with no problems.</p>
<pre class="r"><code># same layout fr 
lo = layout_with_fr(sim_g)
plot(sim_g, layout = lo)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-9-1.png" width="90%" /></p>
<pre class="r"><code># use lo in ggraph 
sim_g %&gt;%
    ggraph(layout = lo) +
    geom_edge_link() + 
    geom_node_point()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-9-2.png" width="90%" /></p>
</div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p><code>patchwork</code> has many other functions that allow you to assemble plot layouts, add labels to plots, and choose relative heights and widths. Learn more from the author at <a href="https://patchwork.data-imaginist.com/" class="uri">https://patchwork.data-imaginist.com/</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
